FROM ubuntu:22.04

LABEL mantainer="nommon@nommon.com"
LABEL author="steso"
LABEL version="1.0"


#RUN rm -r /var/lib/apt/lists/*
# Update Apt
RUN apt update -y

# Configure Timezone
RUN apt install tzdata -y && ln -fs /usr/share/zoneinfo/Europe/Madrid /etc/localtime \
        && dpkg-reconfigure -f noninteractive tzdata

# Install Python3/nginx/neccesary libraries
RUN apt-get update && apt-get install -y \
         wget \
         python3 \
         python3-setuptools \
         python3-pip \
         build-essential \
         nginx \
         ca-certificates \
         iputils-ping

# Required system libraries (Pending check)
RUN apt-get update
RUN apt-get install software-properties-common -y
RUN apt-get install python3-software-properties -y
## the following line install version 2 of GDAL, we need version 1.11 that is included without this
#RUN add-apt-repository ppa:ubuntugis/ubuntugis-unstable
#RUN sudo add-apt-repository --remove ppa:webupd8team/ppa
#RUN sudo apt update

RUN apt-get install build-essential libssl-dev libffi-dev python3-dev \
            libmysqlclient-dev liblzma-dev libpng-dev libfreetype6-dev \
            libblas-dev liblapack-dev libatlas-base-dev gfortran libgdal-dev\
                pigz curl nginx gunicorn -y
RUN apt-get install gdal-bin -y
RUN apt-get install python3-gdal -y

## Install testing libraries
RUN pip install pytest
RUN pip install pytest-html
RUN pip install pytest-mock
RUN pip install coverage
RUN pip install requests-mock
RUN pip install pylint

# INSTALL JUPYTER NOTEBOOK
RUN pip install jupyterlab==3.4.5
RUN echo "alias jl='jupyter lab --ip=0.0.0.0 --port=8888 --no-browser  \
    --allow-root --NotebookApp.token='" > ~/.bash_aliases


# INSTALL JAVA
RUN apt install curl mlocate default-jdk -y # install java
# Establish workdir
WORKDIR /opt/shared

# Set python environment variables
ENV PYTHONUNBUFFERED=TRUE
ENV PYTHONDONTWRITEBYTECODE=TRUE
ENV PATH="/opt/shared:${PATH}"
ENV PYTHONPATH="/opt/shared"

